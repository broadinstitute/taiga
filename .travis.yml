branches:
  only:
  - "/.*/"
notifications:
  email:
    recipients:
    - pmontgom@broadinstitute.org
language: python
python:
- '3.6'
before_install:
- openssl aes-256-cbc -K $encrypted_1f8527a9b911_key -iv $encrypted_1f8527a9b911_iv -in travis/travis-docker-push-account.json.enc -out travis/travis-docker-push-account.json -d
- openssl aes-256-cbc -K $encrypted_0a6446eb3ae3_key -iv $encrypted_0a6446eb3ae3_iv -in travis/travis-docker-push-account.json.enc -out travis/travis-docker-push-account.json -d
install:
- sh write_version.sh
- wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
- bash miniconda.sh -b -p $HOME/miniconda
- export PATH="$HOME/miniconda/bin:$PATH"
- hash -r
- conda config --set always_yes yes --set changeps1 no
- conda update -q conda
- conda info -a
- conda create -q -n test-environment -c bioconda python=$TRAVIS_PYTHON_VERSION bioconductor-rhdf5
  numpy=1.11.3
- source activate test-environment
- pip install -U pip setuptools
- python setup.py install
- pip install -r requirements.txt
services:
- docker
script:
- pytest
after_success:
- if [ "$TRAVIS_BRANCH" == "master" ]; then bash ./build_docker.sh; chmod ugo+x travis/push_docker.sh;
  travis/push_docker.sh; fi
